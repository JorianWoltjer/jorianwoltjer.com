{% extends "base.html" %} {% block title %}Home{% endblock %} {% block scripts %}
<script nonce="{{ metadata.nonce }}">
  const alertElem = document.getElementById("alert");
  const button = document.querySelector("#login-form button[type=submit]");

  document.getElementById("login-form").addEventListener("submit", (e) => {
    e.preventDefault();
    alertElem.innerHTML = "";
    button.disabled = true;
    button.textContent = "Submitting...";
    const { password } = e.target;

    fetch(e.target.action, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({ password: password.value.trim() }),
    }).then(async (res) => {
      if (res.ok) {
        try {
          await navigation.back().finished;
        } catch (e) {
          console.error(e);
          document.location.href = "/blog";
        }
      } else {
        alertElem.innerHTML = `<div class="alert error">Invalid password</div>`;
      }
      button.disabled = false;
      button.textContent = "Submit";
    });
  });
</script>
{% endblock %} {% block main %}
<form id="login-form" class="center-box" action="/login" method="post">
  <h1>Admin login</h1>
  <div id="alert"></div>
  <input type="password" name="password" placeholder="Password..." required autofocus />
  <button type="submit">Submit</button>
</form>
{% endblock %}
